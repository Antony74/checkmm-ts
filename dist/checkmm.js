(()=>{"use strict";var e={13:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&o(t,e,r);return n(t,e),t},i=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(n,s){function i(e){try{f(o.next(e))}catch(e){s(e)}}function a(e){try{f(o.throw(e))}catch(e){s(e)}}function f(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}f((o=o.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Scope=t.Assertion=void 0;const f=a(r(17)),l=s(r(896));let c=[],u=new Set,h=new Map,p=new Set;class d{constructor(){this.hypotheses=[],this.disjvars=new Set,this.expression=[]}}t.Assertion=d;let m=new Map;class g{constructor(){this.activevariables=new Set,this.activehyp=[],this.disjvars=[],this.floatinghyp=new Map}}t.Scope=g;let v=new Array,y=e=>void 0!==h.get(e)||void 0!==m.get(e),b=e=>{for(const t of v){const r=t.floatinghyp.get(e);if(void 0!==r)return r}return""},$=e=>{for(const t of v)if(t.activevariables.has(e))return!0;return!1},w=e=>{for(const t of v)if(t.activehyp.find((t=>e===t)))return!0;return!1},_=(e,t)=>{if(e===t)return!1;for(const r of v)for(const o of r.disjvars)if(o.has(e)&&o.has(t))return!0;return!1},A=e=>" "===e||"\n"===e||"\t"===e||"\f"===e||"\r"===e,S=e=>{for(const t of e)if(!l.default.isalnum(t)&&"."!==t&&"-"!==t&&"_"!==t)return!1;return!0},k=e=>!e.includes("$"),x=e=>{for(const t of e)if(!l.default.isupper(t)&&"?"!==t)return!1;return!0},P=e=>{let t,r="";for(;(t=e.get())&&A(t););for(e.good()&&e.unget();(t=e.get())&&!A(t);){if(t<"!"||t>"~")return console.error("Invalid character read with code 0x"+t.charCodeAt(0).toString(16)),"";r+=t}return!e.eof()&&e.fail()?"":r};const I=new Set;let j=e=>i(void 0,void 0,void 0,(function*(){if(I.has(e))return!0;let t;I.add(e);try{t=yield l.default.ifstream(e)}catch(e){}if(!t)return console.error("Could not open "+e),!1;let r,o=!1,n=!1,s="";for(;(r=P(t)).length;)if(o){if("$)"===r){o=!1;continue}if(r.includes("$("))return console.error("Characters $( found in a comment"),!1;if(r.includes("$)"))return console.error("Characters $) found in a comment"),!1}else if("$("!==r)if(n){if(s.length){if("$]"!==r)return console.error("Didn't find closing file inclusion delimiter"),!1;if(!(yield j(s)))return!1;n=!1,s="";continue}if(r.includes("$"))return console.error("Filename "+r+" contains a $"),!1;s=f.default.normalize(f.default.join(f.default.dirname(e),r))}else"$["!==r?c.push(r):n=!0;else o=!0;return t.eof()?o?(console.error("Unclosed comment"),!1):!n||(console.error("Unfinished file inclusion command"),!1):(t.fail()&&console.error("Error reading from "+e),!1)})),E=(e,t)=>{const r=new d;m.set(e,r),r.expression=t;const o=new Set;for(const e of t)p.has(e)&&o.add(e);for(const e of v.slice().reverse()){const t=e.activehyp;for(const e of t.slice().reverse()){const t=h.get(e);if(t.second&&o.has(t.first[1]))r.hypotheses.unshift(e);else if(!t.second){r.hypotheses.unshift(e);for(const e of t.first)p.has(e)&&o.add(e)}}}for(const e of v){const t=e.disjvars;for(const e of t){const t=Array.from(l.default.set_intersection(e,o));for(let e=0;e<t.length;++e)for(let o=e+1;o<t.length;++o)r.disjvars.add({first:t[e],second:t[o]})}}return r},M=(e,t,r)=>{if(!c.length)return void console.error("Unfinished $"+e+" statement "+t);const o=c[c.length-1];if(!u.has(o))return void console.error("First symbol in $"+e+" statement "+t+" is "+o+" which is not a constant");c.pop();const n=[o];let s;for(;c.length&&(s=c[c.length-1])!==r;){if(c.pop(),!u.has(s)&&!b(s).length)return void console.error("In $"+e+" statement "+t+" token "+s+" found which is not a constant or variable in an active $f statement");n.push(s)}if(c.length)return c.pop(),n;console.error("Unfinished $"+e+" statement "+t)},U=(e,t)=>{let r=[];for(const o of e){const e=t.get(o);e?r=[...r,...e]:r.push(o)}return r},q=(e,t)=>{const r=[];let o=0,n=!1;for(const s of t)if(s<="T"){const t=s.charCodeAt(0)-("A".charCodeAt(0)-1);if(o>Number.MAX_SAFE_INTEGER/20||20*o>Number.MAX_SAFE_INTEGER-t)return void console.error("Overflow computing numbers in compressed proof of "+e);r.push(20*o+t),o=0,n=!0}else if(s<="Y"){const t=s.charCodeAt(0)-"T".charCodeAt(0);if(o>Number.MAX_SAFE_INTEGER/5||5*o>Number.MAX_SAFE_INTEGER-t)return void console.error("Overflow computing numbers in compressed proof of "+e);o=5*o+t,n=!1}else{if(!n)return void console.error("Stray Z found in compressed proof of "+e);r.push(0),n=!1}if(0===o)return r;console.error("Compressed proof of theorem "+e+" ends in unfinished number")},C=(e,t,r)=>{const o=m.get(t);if(r.size()<o.hypotheses.length)return void console.error("In proof of theorem "+e+" not enough items found on stack");const n=r.size()-o.hypotheses.length,s=new Map;for(let t=0;t<o.hypotheses.length;++t){const i=h.get(o.hypotheses[t]);if(i.second){if(i.first[0]!==r.at(n+t)[0])return void console.error("In proof of theorem "+e+" unification failed");const o=r.at(n+t).slice(1);s.set(i.first[1],o)}else{const o=U(i.first,s);if(!l.default.arraysequal(o,r.at(n+t)))return void console.error("In proof of theorem "+e+" unification failed")}}r.truncate(n);for(const t of o.disjvars){const r=s.get(t.first),o=s.get(t.second),n=new Set;for(const e of r)p.has(e)&&n.add(e);const i=new Set;for(const e of o)p.has(e)&&i.add(e);for(const t of n)for(const r of i)if(!_(t,r))return void console.error("In proof of theorem "+e+" disjoint variable restriction violated")}const i=U(o.expression,s);return r.push(i),r},O=(e,t,r)=>{let o=l.default.createStack();for(const t of r){const r=h.get(t);if(r)o.push(r.first);else if(o=C(e,t,o),void 0===o)return!1}return 1!==o.size()?(console.error("Proof of theorem "+e+" does not end with only one item on the stack"),!1):!!l.default.arraysequal(o.at(0),t.expression)||(console.error("Proof of theorem "+e+" proves wrong statement"),!1)},N=(e,t,r,o)=>{let n=(0,l.createStack)();const s=t.hypotheses.length,i=s+r.length,a=[];for(const f of o)if(0!==f)if(f<=s)n.push(h.get(t.hypotheses[f-1]).first);else if(f<=i){const t=r[f-s-1],o=h.get(t);if(o){n.push(o.first);continue}if(n=C(e,t,n),void 0===n)return!1}else{if(f>i+a.length)return console.error("Number in compressed proof of "+e+" is too high"),!1;n.push(a[f-i-1])}else a.push(n.top());return 1!==n.size()?(console.error("Proof of theorem "+e+" does not end with only one item on the stack"),!1):!!l.default.arraysequal(n.at(0),t.expression)||(console.error("Proof of theorem "+e+" proves wrong statement"),!1)},T=e=>{const t=M("p",e,"$=");if(!t)return!1;const r=E(e,t);if(!c.length)return console.error("Unfinished $p statement "+e),!1;if("("===c[c.length-1]){c.pop();const t=[];let o;for(;c.length&&")"!==(o=c[c.length-1]);){if(c.pop(),t.push(o),o===e)return console.error("Proof of theorem "+e+" refers to itself"),!1;if(r.hypotheses.find((e=>e===o)))return console.error("Compressed proof of theorem "+e+" has mandatory hypothesis "+o+" in label list"),!1;if(!m.has(o)&&!w(o))return console.error("Proof of theorem "+e+" refers to "+o+" which is not an active statement"),!1}if(!c.length)return console.error("Unfinished $p statement "+e),!1;c.pop();let n="";for(;c.length&&"$."!==(o=c[c.length-1]);)if(c.pop(),n+=o,!x(o))return console.error("Bogus character found in compressed proof of "+e),!1;if(!c.length)return console.error("Unfinished $p statement "+e),!1;if(!n.length)return console.error("Theorem "+e+" has no proof"),!1;if(c.pop(),n.includes("?"))return console.error("Warning: Proof of theorem "+e+" is incomplete"),!0;const s=q(e,n);if(!s)return!1;if(!N(e,r,t,s))return!1}else{const t=[];let o,n=!1;for(;c.length&&"$."!==(o=c[c.length-1]);)if(c.pop(),t.push(o),"?"===o)n=!0;else{if(o===e)return console.error("Proof of theorem "+e+" refers to itself"),!1;if(!m.has(o)&&!w(o))return console.error("Proof of theorem "+e+" refers to "+o+" which is not an active statement"),!1}if(!c.length)return console.error("Unfinished $p statement "+e),!1;if(!t.length)return console.error("Theorem "+e+" has no proof"),!1;if(c.pop(),n)return console.error("Warning: Proof of theorem "+e+" is incomplete"),!0;if(!O(e,r,t))return!1}return!0},z=e=>{const t=M("e",e,"$.");return!!t&&(h.set(e,{first:t,second:!1}),v[v.length-1].activehyp.push(e),!0)},F=e=>{const t=M("a",e,"$.");return!!t&&(E(e,t),!0)},D=e=>{if(!c.length)return console.error("Unfinished $f statement"+e),!1;const t=c[c.length-1];if(!u.has(t))return console.error("First symbol in $f statement "+e+" is "+t+" which is not a constant"),!1;if(c.pop(),!c.length)return console.error("Unfinished $f statement "+e),!1;const r=c[c.length-1];if(!$(r))return console.error("Second symbol in $f statement "+e+" is "+r+" which is not an active variable"),!1;if(b(r).length)return console.error("The variable "+r+" appears in a second $f statement "+e),!1;if(c.pop(),!c.length)return console.error("Unfinished $f statement"+e),!1;if("$."!==c[c.length-1])return console.error("Expected end of $f statement "+e+" but found "+c[c.length-1]),!1;c.pop();const o=[];return o.push(t),o.push(r),h.set(e,{first:o,second:!0}),v[v.length-1].activehyp.push(e),v[v.length-1].floatinghyp.set(r,e),!0},G=e=>{if(u.has(e))return console.error("Attempt to reuse constant "+e+" as a label"),!1;if(p.has(e))return console.error("Attempt to reuse variable "+e+" as a label"),!1;if(y(e))return console.error("Attempt to reuse label "+e),!1;if(!c.length)return console.error("Unfinished labeled statement"),!1;const t=c.pop();let r=!0;if("$p"===t)r=T(e);else if("$e"===t)r=z(e);else if("$a"===t)r=F(e);else{if("$f"!==t)return console.error("Unexpected token "+t+" encountered"),!1;r=D(e)}return r},R=()=>{const e=new Set;let t;for(;c.length&&"$."!==(t=c[c.length-1]);){if(c.pop(),!$(t))return console.error("Token "+t+" is not an active variable, but was found in a $d statement"),!1;if(e.has(t))return console.error("$d statement mentions "+t+" twice"),!1;e.add(t)}return c.length?e.size<2?(console.error("Not enough items in $d statement"),!1):(v[v.length-1].disjvars.push(e),c.pop(),!0):(console.error("Unterminated $d statement"),!1)},V=()=>{if(v.length>1)return console.error("$c statement occurs in inner block"),!1;let e,t=!0;for(;c.length&&"$."!==(e=c[c.length-1]);){if(c.pop(),t=!1,!k(e))return console.error("Attempt to declare "+e+" as a constant"),!1;if(p.has(e))return console.error("Attempt to redeclare variable "+e+" as a constant"),!1;if(y(e))return console.error("Attempt to reuse label "+e+" as a constant"),!1;if(u.has(e))return console.error("Attempt to redeclare constant "+e),!1;u.add(e)}return c.length?t?(console.error("Empty $c statement"),!1):(c.pop(),!0):(console.error("Unterminated $c statement"),!1)},X=()=>{let e,t=!0;for(;c.length&&"$."!==(e=c[c.length-1]);){if(c.pop(),t=!1,!k(e))return console.error("Attempt to declare "+e+" as a variable"),!1;if(u.has(e))return console.error("Attempt to redeclare constant "+e+" as a variable"),!1;if(y(e))return console.error("Attempt to reuse label "+e+" as a variable"),!1;if($(e))return console.error("Attempt to redeclare active variable "+e),!1;p.add(e),v[v.length-1].activevariables.add(e)}return c.length?t?(console.error("Empty $v statement"),!1):(c.pop(),!0):(console.error("Unterminated $v statement"),!1)},Z=e=>i(void 0,void 0,void 0,(function*(){if(2!==e.length)return console.error("Syntax: checkmm <filename>"),1;if(!(yield j(e[1])))return 1;for(c.reverse(),v.push(new g);c.length;){const e=c.pop();let t=!0;if(S(e))t=G(e);else if("$d"===e)t=R();else if("${"===e)v.push(new g);else if("$}"===e){if(v.pop(),!v.length)return console.error("$} without corresponding ${"),1}else if("$c"===e)t=V();else{if("$v"!==e)return console.error("Unexpected token "+e+" encountered"),1;t=X()}if(!t)return 1}return v.length>1?(console.error("${ without corresponding $}"),1):0}));const B=process.argv.length>=2?process.argv[1]:"";[__filename,".bin/checkmm","cli.js"].reduce(((e,t)=>e||B.slice(-t.length)===t),!1)&&Z(process.argv.slice(1)).then((e=>{process.exitCode=e})),t.default={tokens:c,setTokens:e=>{c=e},constants:u,setConstants:e=>{u=e},hypotheses:h,setHypotheses:e=>{h=e},variables:p,setVariables:e=>{p=e},assertions:m,setAssertions:e=>{m=e},scopes:v,setScopes:e=>{v=e},labelused:y,setLabelused:e=>{y=e},getfloatinghyp:b,setGetfloatinghyp:e=>{b=e},isactivevariable:$,setIsactivevariable:e=>{$=e},isactivehyp:w,setIsactivehyp:e=>{w=e},isdvr:_,setIsdvr:e=>{_=e},ismmws:A,setIsmmws:e=>{A=e},islabeltoken:S,setIslabeltoken:e=>{S=e},ismathsymboltoken:k,setIsmathsymboltoken:e=>{k=e},containsonlyupperorq:x,setContainsonlyupperorq:e=>{x=e},nexttoken:P,setNexttoken:e=>{P=e},readtokens:j,setReadtokens:e=>{j=e},constructassertion:E,setConstructassertion:e=>{E=e},readexpression:M,setReadexpression:e=>{M=e},makesubstitution:U,setMakesubstitution:e=>{U=e},getproofnumbers:q,setGetproofnumbers:e=>{q=e},verifyassertionref:C,setVerifyassertionref:e=>{C=e},verifyregularproof:O,setVerifyrefularproof:e=>{O=e},verifycompressedproof:N,setVerifycompressedproof:e=>{N=e},parsep:T,setParsep:e=>{T=e},parsee:z,setParsee:e=>{z=e},parsea:F,setParsea:e=>{F=e},parsef:D,setParsef:e=>{D=e},parselabel:G,setParselabel:e=>{G=e},parsed:R,setParsed:e=>{R=e},parsec:V,setParsec:e=>{V=e},parsev:X,setParsev:e=>{X=e},main:Z,setMain:e=>{Z=e}}},896:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(n,s){function i(e){try{f(o.next(e))}catch(e){s(e)}}function a(e){try{f(o.throw(e))}catch(e){s(e)}}function f(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}f((o=o.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createStack=t.arraysequal=t.Deque=t.Vector=void 0;const s=n(r(147)),i=(0,r(837).promisify)(s.default.readFile);let a=e=>!/[^A-Z]/.test(e),f=e=>!/[^a-zA-Z0-9]/.test(e),l=(e,t)=>{const r=new Set;return e.forEach((e=>{t.has(e)&&r.add(e)})),r};t.Vector=class extends Array{},t.Deque=class extends Array{};let c=e=>{let t=0;return{get:()=>{const r=e.charAt(t);return++t,r},good:()=>!0,unget:()=>{--t},eof:()=>t>=c.length,fail:()=>!1}},u=e=>o(void 0,void 0,void 0,(function*(){return c(yield i(e,{encoding:"utf-8"}))}));t.arraysequal=(e,t)=>{if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0},t.createStack=e=>{let t=null!=e?e:[];return{push:e=>{t.push(e)},pop:()=>t.pop(),size:()=>t.length,top:()=>t[t.length-1],truncate:e=>{t=t.slice(0,e)},at:e=>t[e],toArray:()=>[...t]}},t.default={isupper:a,setIsupper:e=>{a=e},isalnum:f,setIsalum:e=>{f=e},set_intersection:l,setSet_intersection:e=>{l=e},stringstream:c,setStringstream:e=>{c=e},ifstream:u,setIfstream:e=>{u=e},arraysequal:t.arraysequal,setArraysequal:e=>{t.arraysequal=e},createStack:t.createStack,setCreateStack:e=>{t.createStack=e}}},147:e=>{e.exports=require("fs")},17:e=>{e.exports=require("path")},837:e=>{e.exports=require("util")}},t={};!function r(o){var n=t[o];if(void 0!==n)return n.exports;var s=t[o]={exports:{}};return e[o].call(s.exports,s,s.exports,r),s.exports}(13)})();